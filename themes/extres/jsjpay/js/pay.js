(function(){var a=false;var t=$(this).data("pid"),n=$("#J_read_jsjpay_get_"+t);$("a.J_plugin_jsjpay").on("click",function(t){t.preventDefault();if(a){return}a=true;Wind.Util.ajaxMaskShow();$.post($(this).data("uri"),function(t){a=false;Wind.Util.ajaxMaskRemove();if(Wind.Util.ajaxTempError(t)){return}Wind.use("dialog",function(){Wind.dialog.html(t,{id:"J_jsjpay_pop",title:"支付宝在线充值",isMask:false,isDrag:true,callback:function(){e()}})})},"html").fail(function(){a=false})});function e(){$("a.J_jsjpay_item").on("click",function(a){a.preventDefault();var t=$(this),n=t.parents("tr"),e=n.find("input.J_jsjpay_credits");e.val(t.text())});$("#J_jsjpay_reason_select").on("change",function(){$("#J_jsjpay_reason").val(this.value)});var a=$("#J_jsjpay_form"),t=a.find("button:submit");a.on("submit",function(n){n.preventDefault();Wind.use("ajaxForm",function(){a.ajaxSubmit({dataType:"json",beforeSubmit:function(){Wind.Util.ajaxBtnDisable(t)},success:function(a){Wind.Util.ajaxBtnEnable(t);if(a.state=="success"){Wind.Util.formBtnTips({wrap:t.parent(),msg:a.message,callback:function(){$("#J_jsjpay_pop").remove();location.reload()}})}else{Wind.Util.formBtnTips({error:true,wrap:t.parent(),msg:a.message})}}})})})}var i=$("form.J_jsjpaylist_form");if(!i.length){return}i.each(function(a,t){var n=$(this),e,i;n.on("change","input.J_jsjpaycheck_all",function(a){i=n.find("input.J_jsjpaycheck");if(this.checked){i.prop("checked",true)}else{i.prop("checked",false)}}).on("change","input.J_jsjpaycheck",function(a){i=n.find("input.J_jsjpaycheck");e=n.find("input.J_jsjpaycheck_all");if(this.checked){if(!i.filter(":not(:checked)").length){e.prop("checked",true)}}else{e.prop("checked",false)}})});Wind.use("ajaxForm",function(){i.ajaxForm({dataType:"json",beforeSubmit:function(a,t,n){Wind.Util.ajaxBtnDisable(t.find("button.J_jsjpaylist_del"))},success:function(a,t,n,e){var i=e.find("button.J_jsjpaylist_del");Wind.Util.ajaxBtnEnable(i);if(a.state=="success"){Wind.Util.formBtnTips({wrap:i.parent(),msg:a.message,callback:function(){location.reload()}})}else{Wind.Util.formBtnTips({error:true,wrap:i.parent(),msg:a.message})}}})});var r=false;i.on("click",".J_plugin_jsjpay_page a",function(a){a.preventDefault();var t=$(this);if(r){return}r=false;Wind.Util.ajaxMaskShow();$.get(this.href,function(a){if(Wind.Util.ajaxTempError(a)){return}Wind.Util.ajaxMaskRemove();var n=t.parents("form.J_jsjpaylist_form");n.html(a);var e=n.find("img.J_avatar");if(e.length){Wind.Util.avatarError(e)}})})})();