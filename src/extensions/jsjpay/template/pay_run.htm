<hook-action name="pay" args="hook,data">
<style>
.alip{line-height:40px;}.alip img{position:absolute;padding-top:8px;}
</style>
<div class="credit_page">
	<form action="index.php?m=app&app=jsjpay&act=post" method="post" onsubmit="return Juge(this)">
	<div class="credit_total" style="margin-top:-20px">
		<h2>充值比例<span> 1元人民币 = {$hook['bili']}{$hook['cunit']}{$hook['cname']} (最少充值{$hook['min']}{$hook['cunit']}{$hook['cname']})</span></h2>
		<h2 class="alip">支付方式<span> <img src="src/extensions/jsjpay/res/images/alipay.jpg"></span></h2>
		<h2>充值数量<span> <input type="text" class="input length_2 mr10" name="num" id="num" onkeyup="changenumb()" required="required">{$hook['cunit']}{$hook['cname']}　　<span id="hjrmb" style="color:red"></span></span>  			
		</h2>
		<h2>　　　　<span> <button type="submit" class="btn btn_big btn_submit">充值</button>　　充值过程中请勿关闭页面，直至从支付宝返回本站。</span></h2>
	</div>
	</form>

	<form action="{@url:profile/extends/run}&_left=credit&_tab=jsjpay" method="post">
	<div class="profile_searcha" style="margin-top:80px">
		<table width="100%">
			<colgroup>
				<col><col width="200">
			</colgroup>
			<tbody>
			<tr>	<th><h2>我的充值记录</h2></th>
				<td>{$data['num']}条  <a href="{@url:profile/extends/run}&_left=credit&_tab=jsjpay">[全部]</a></td>

				<th><span class="mr10">从</span><input type="text" class="input length_2 J_date date" name="time_start" value="{@Pw::time2str($data[args][time_start], 'Y-m-d')}"></th>
				<td><span class="mr10">至</span><input type="text" class="input length_2 J_date date" name="time_end" value="{@Pw::time2str($data[args][time_end], 'Y-m-d')}"> <select class="select_1" name="op"><option value="" {@Pw::isSelected($data[args][op]=='0')}>全部</option><option value="1" {@Pw::isSelected($data[args][op]=='1')}>成功</option><option value="9" {@Pw::isSelected($data[args][op]=='9')}>失败</option></select> <button type="submit" class="btn">搜索</button></td>

			</tr>
			</tbody>
		</table>
	</div>
	</form>
	<style>.order_history tr:hover{background:#F5F5F5;}</style>
	<div class="order_history">
		<table width="100%" class="mb10">
			<thead>
			<tr>
				<td class="num" width="80">流水号</td>
				<td width="70">人民币</td>
				<td width="90">{$hook['cname']}</td>
				<td>订单编号</td>
				<td width="70"></td>
				<td width="110">时间</td>
				<td width="30">删除</td>
			</tr>
			</thead>
			<!--# if ($data['num'] <= '0') { #-->
			<tr><td colspan="7" class="tac w">啊哦，没有符合条件的内容！</td></tr>
			<!--# }else{ #-->
			<form action="{@url:profile/extends/run}&_left=credit&_tab=jsjpay&act=delete" method="post">
			<!--# } #-->
			<!--# foreach ($data['list'] as $val) { #-->
			<tr>
				<td class="num">{$val['id']}</td>
				<td>&yen{$val['total']}</td>
				<td>
				<!--# if ($val['op']=='1') { #-->
				<span class="green">+{$val['total']*$hook['bili']}</span>
				<!--# } #-->
				</td>
				<td>{$val['addnum']}</td>
				<td>
				<!--# if ($val['op']=='1') { #-->
				<span class="green">充值成功</span><!--# }else{ #-->
				<span class="red">未支付</span>
				<!--# } #-->
				</td>
				<td>{@Pw::time2str($val['time'], 'Y-m-d H:i')}</td>
				<td><input type="checkbox" name="showid[]" value="{$val['id']}" style="background:none;border:none;"/></td>
			</tr>
			<!--# } #-->
			<!--# if ($data['num'] > '0') { #-->
			<tr><td colspan="7" class="tac w">
			<button type="button" class="btn" onClick="selectBox('all')">全选</button> 
			<button type="button" class="btn" onClick="selectBox('reverse')">反选</button>
			<button type="submit" class="btn btn_submit"><strong>删除</strong></button>
			</td></tr>
			</form>
			<!--# } #-->
		</table>			
		<page tpl="TPL:common.page" count="$data['num']" page="$data['page']" per="$data['perpage']" args="$data['args']" url="profile/extends/run" />
	</div>

</div>
<script type="text/javascript">
function changenumb() {
	var num = document.getElementById("num").value.toInt();
	rmb = num / {$hook['bili']};
	zj = Math.ceil(rmb);

	if(num >= {$hook['min']}) {
		document.getElementById("hjrmb").innerHTML = '需要支付人民币&yen: '+zj;
	}else{
		document.getElementById("hjrmb").innerHTML = '';
	}
}
String.prototype.toInt = function() {
	var s = parseInt(this);
	return isNaN(s) ? 0 : s;
}
changenumb();

function fnRemoveBrank(strSource){
	return strSource.replace(/^\s*/,'').replace(/\s*$/,'');
}
function Juge(theForm){

if (fnRemoveBrank(theForm.num.value) == ""){
Wind.use('jquery', 'global',function(){Wind.Util.resultTip({
error : true,msg : "请输入充值的{$hook['cname']}数量"});});
theForm.num.focus();return (false);
}

var str = parseInt(theForm.num.value);
var min = parseInt({$hook['min']});
if (str < min){
Wind.use('jquery', 'global',function(){Wind.Util.resultTip({
error : true,msg : "请输入限额内的充值数量(大于等于{$hook['min']}{$hook['cname']})"});});
theForm.num.focus();return (false);
}


if (fnRemoveBrank(theForm.num.value) != str){
Wind.use('jquery', 'global',function(){Wind.Util.resultTip({
error : true,msg : "充值数量只能输入整数"});});
theForm.num.focus();return (false);
}

}

function selectBox(selectType){  
var checkboxis = document.getElementsByName("showid[]");  
   if(selectType == "reverse"){  
            for (var i=0; i<checkboxis.length; i++){  
                //alert(checkboxis[i].checked);  
                checkboxis[i].checked = !checkboxis[i].checked;  
            }  
   }else if(selectType == "all"){  
            for (var i=0; i<checkboxis.length; i++){ 
                //alert(checkboxis[i].checked); 
                checkboxis[i].checked = true;
	   } 
    }
}
</script>
</hook-action>
<hook-action name="delete" args="error">
	<div class="profile_table">
		<div class="not_content"><span class="green">啊哦，删除成功了！</span> <a href="{@url:profile/extends/run}&_left=credit&_tab=jsjpay">[返回]</a>
		</div>
	</div>
</hook-action>